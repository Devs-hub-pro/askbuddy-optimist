
<!-- City Selector Page -->
<view class="container">
  <!-- Header -->
  <view class="header">
    <navigator open-type="navigateBack" class="back-btn">
      <image src="/assets/icons/arrow-left.png" style="width: 20px; height: 20px;" />
    </navigator>
    <view class="title">选择城市</view>
    <view style="width: 20px;"></view>
  </view>
  
  <!-- Search Bar -->
  <view class="search-container">
    <view class="search-box">
      <image src="/assets/icons/search.png" style="width: 18px; height: 18px;" />
      <input type="text" placeholder="输入城市名进行搜索" bindinput="onSearchInput" value="{{searchKeyword}}" />
    </view>
    <view class="cancel-btn" bindtap="clearSearch">取消</view>
  </view>
  
  <!-- Current Location -->
  <view class="current-location">
    <view class="location-label">当前城市：{{currentCity}}</view>
    <view class="relocate-btn" bindtap="useCurrentLocation">
      <image src="/assets/icons/locate.png" style="width: 16px; height: 16px; margin-right: 4px;" />
      重新定位
    </view>
  </view>
  
  <!-- Recent Cities -->
  <block wx:if="{{recentCities.length > 0 && !searchKeyword}}">
    <view class="section">
      <view class="section-title">最近访问的城市</view>
      <view class="city-grid">
        <block wx:for="{{recentCities}}" wx:key="*this">
          <view 
            class="city-item"
            bindtap="selectCity"
            data-city="{{item}}"
          >
            {{item}}
          </view>
        </block>
      </view>
    </view>
  </block>
  
  <!-- Hot Cities -->
  <view class="section" wx:if="{{!searchKeyword}}">
    <view class="section-title">热门城市</view>
    <view class="city-grid">
      <block wx:for="{{hotCities}}" wx:key="*this">
        <view 
          class="city-item"
          bindtap="selectCity"
          data-city="{{item}}"
        >
          {{item}}
        </view>
      </block>
    </view>
  </view>
  
  <!-- Search Results -->
  <view class="section" wx:if="{{searchKeyword && filteredCities.length > 0}}">
    <view class="city-list">
      <block wx:for="{{filteredCities}}" wx:key="*this">
        <view 
          class="city-list-item" 
          bindtap="selectCity"
          data-city="{{item}}"
        >
          {{item}}
        </view>
      </block>
    </view>
  </view>
  
  <!-- No Results -->
  <view class="no-results" wx:if="{{searchKeyword && filteredCities.length === 0}}">
    <view>未找到匹配的城市</view>
  </view>
  
  <!-- All Cities -->
  <view class="city-container" wx:if="{{!searchKeyword}}">
    <!-- City List -->
    <scroll-view 
      class="city-scroll"
      scroll-y
      scroll-into-view="{{scrollIntoView}}"
      style="height: calc(100vh - 220px);"
    >
      <block wx:for="{{alphabet}}" wx:key="*this" wx:for-item="letter">
        <block wx:if="{{allCities[letter] && allCities[letter].length > 0}}">
          <view id="section-{{letter}}" class="index-letter">
            {{letter}}
          </view>
          <view class="city-list">
            <block wx:for="{{allCities[letter]}}" wx:key="*this">
              <view 
                class="city-list-item" 
                bindtap="selectCity"
                data-city="{{item}}"
              >
                {{item}}
              </view>
            </block>
          </view>
        </block>
      </block>
    </scroll-view>
    
    <!-- Alphabet Index -->
    <view class="index-bar">
      <block wx:for="{{alphabet}}" wx:key="*this">
        <view 
          class="index-item" 
          bindtap="scrollToSection"
          data-alphabet="{{item}}"
        >
          {{item}}
        </view>
      </block>
    </view>
  </view>
</view>
