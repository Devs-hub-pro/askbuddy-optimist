
<!-- City Selector Page -->
<view class="container">
  <!-- Header -->
  <view class="header">
    <navigator open-type="navigateBack" class="back-btn">
      <image src="/assets/icons/arrow-left.png" style="width: 20px; height: 20px;" />
    </navigator>
    <view class="title">选择城市</view>
    <view style="width: 20px;"></view>
  </view>
  
  <!-- Search Bar -->
  <view class="search-container">
    <view class="search-box">
      <image src="/assets/icons/search.png" style="width: 18px; height: 18px;" />
      <input type="text" placeholder="搜索城市、国家" bindinput="onSearchInput" value="{{searchKeyword}}" />
      <image wx:if="{{searchKeyword}}" src="/assets/icons/x.png" style="width: 16px; height: 16px;" bindtap="clearSearch" />
    </view>
  </view>
  
  <!-- Tabs for Mainland/Overseas -->
  <view wx:if="{{!searchKeyword}}" class="tabs">
    <view 
      class="tab {{activeTab === 'mainland' ? 'tab-active' : ''}}" 
      bindtap="switchTab" 
      data-tab="mainland"
    >
      中国大陆
    </view>
    <view 
      class="tab {{activeTab === 'overseas' ? 'tab-active' : ''}}" 
      bindtap="switchTab" 
      data-tab="overseas"
    >
      海外地区
    </view>
  </view>
  
  <!-- Search Results -->
  <block wx:if="{{searchKeyword}}">
    <view class="section">
      <view class="section-title">搜索结果</view>
      <view wx:if="{{filteredCities.length > 0}}" class="city-list">
        <block wx:for="{{filteredCities}}" wx:key="*this">
          <view class="city-list-item" bindtap="selectCity" data-city="{{item}}">
            {{item}}
          </view>
        </block>
      </view>
      <view wx:else class="no-results">
        <view>未找到匹配的城市或国家</view>
      </view>
    </view>
  </block>
  
  <block wx:else>
    <!-- Current Location -->
    <view class="current-location">
      <view class="location-label">当前城市：{{currentCity}}</view>
      <view class="relocate-btn" bindtap="useCurrentLocation">
        <image src="/assets/icons/locate.png" style="width: 16px; height: 16px; margin-right: 4px;" />
        重新定位
      </view>
    </view>
    
    <!-- Recent Cities -->
    <block wx:if="{{recentCities.length > 0}}">
      <view class="section">
        <view class="section-title">最近访问</view>
        <view class="city-grid">
          <block wx:for="{{recentCities}}" wx:key="*this">
            <view class="city-item" bindtap="selectCity" data-city="{{item}}">
              {{item}}
            </view>
          </block>
        </view>
      </view>
    </block>
    
    <!-- Hot Cities -->
    <view class="section">
      <view class="section-title">热门城市/地区</view>
      <view class="city-grid">
        <block wx:for="{{hotCities}}" wx:key="*this">
          <view class="city-item" bindtap="selectCity" data-city="{{item}}">
            {{item}}
          </view>
        </block>
      </view>
    </view>
    
    <!-- Mainland Cities -->
    <block wx:if="{{activeTab === 'mainland'}}">
      <view class="city-container">
        <!-- City List -->
        <scroll-view 
          class="city-scroll"
          scroll-y
          scroll-into-view="{{scrollIntoView}}"
          style="height: calc(100vh - 220px);"
        >
          <block wx:for="{{alphabet}}" wx:key="*this" wx:for-item="letter">
            <block wx:if="{{allCities[letter] && allCities[letter].length > 0}}">
              <view id="section-{{letter}}" class="index-letter">
                {{letter}}
              </view>
              <view class="city-list">
                <block wx:for="{{allCities[letter]}}" wx:key="*this">
                  <view class="city-list-item" bindtap="selectCity" data-city="{{item}}">
                    {{item}}
                  </view>
                </block>
              </view>
            </block>
          </block>
        </scroll-view>
        
        <!-- Alphabet Index -->
        <view class="index-bar">
          <block wx:for="{{alphabet}}" wx:key="*this">
            <view class="index-item" bindtap="scrollToSection" data-alphabet="{{item}}">
              {{item}}
            </view>
          </block>
        </view>
      </view>
    </block>
    
    <!-- Overseas Regions -->
    <block wx:if="{{activeTab === 'overseas'}}">
      <view class="overseas-container">
        <block wx:for="{{overseasRegions}}" wx:key="region" wx:for-item="countries" wx:for-index="region">
          <view class="overseas-region">
            <view class="region-title">{{region}}</view>
            <view class="country-grid">
              <block wx:for="{{countries}}" wx:key="*this">
                <view class="city-item" bindtap="selectCity" data-city="{{item}}">
                  {{item}}
                </view>
              </block>
            </view>
          </view>
        </block>
      </view>
    </block>
  </block>
</view>
