
<view class="container">
  <!-- Navbar -->
  <view class="sticky top-0 z-50 bg-app-teal animate-fade-in">
    <view class="flex items-center h-12 px-4">
      <view bindtap="handleBack" class="flex items-center">
        <image src="/assets/icons/arrow-left.png" style="width: 24px; height: 24px;" />
      </view>
      <view class="text-white font-medium text-base ml-2">达人详情</view>
    </view>
  </view>
  
  <!-- Expert Header -->
  <view class="relative">
    <!-- Background Image -->
    <view class="w-full h-32 bg-gradient-to-r from-blue-500 to-teal-500" style="background-image: url('{{expert.backgroundImage}}'); background-size: cover; background-position: center;">
      <view class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/50 to-transparent"></view>
    </view>
    
    <!-- Profile Info -->
    <view class="px-4 pt-4 pb-6 bg-white relative">
      <view class="flex items-start">
        <image class="w-20 h-20 rounded-full border-4 border-white absolute -top-10" src="{{expert.avatar}}" />
        
        <view class="flex-1 ml-24 mt-2">
          <view class="flex items-center">
            <text class="font-bold text-lg">{{expert.name}}</text>
            <view class="ml-2 px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full flex items-center">
              <image src="/assets/icons/verified.png" class="w-3 h-3 mr-1" />
              已认证
            </view>
          </view>
          <text class="text-sm text-green-600 block">{{expert.title}}</text>
          <view class="flex items-center text-xs text-gray-600 mt-1">
            <image src="/assets/icons/location.png" class="w-3 h-3 mr-1" />
            <text>{{expert.location}}</text>
            <text class="mx-1.5">•</text>
            <text class="text-gray-400">IP属地 {{expert.location}}</text>
          </view>
        </view>
      </view>
      
      <view class="flex justify-between mt-4">
        <view class="flex items-center">
          <image src="/assets/icons/star.png" class="w-4 h-4 mr-1" />
          <text class="text-sm">{{expert.rating}}</text>
        </view>
        <view class="flex items-center">
          <image src="/assets/icons/clock.png" class="w-4 h-4 mr-1" />
          <text class="text-sm">{{expert.responseRate}} 响应率</text>
        </view>
        <view class="flex items-center">
          <image src="/assets/icons/package.png" class="w-4 h-4 mr-1" />
          <text class="text-sm">{{expert.orderCount}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- Expert Description -->
  <view class="px-4 py-4 bg-white mt-2">
    <view class="p-4 bg-gray-50 rounded-lg">
      <text class="text-sm text-gray-700 line-clamp-3" wx:if="{{!showFullDescription}}">{{expert.description}}</text>
      <text class="text-sm text-gray-700" wx:else>{{expert.description}}</text>
      
      <view wx:if="{{expert.description.length > 150}}" class="mt-2">
        <text class="text-blue-600 text-xs" bindtap="toggleDescription">
          {{showFullDescription ? '收起' : '展开全部'}}
        </text>
      </view>
    </view>
  </view>
  
  <!-- Tags -->
  <view class="px-4 py-4 bg-white mt-2">
    <text class="font-bold mb-3 block">擅长话题</text>
    <view class="flex flex-wrap gap-2">
      <view wx:for="{{expert.tags}}" wx:key="*this" class="px-2.5 py-1 bg-green-50 text-green-600 rounded-full text-xs">
        #{{item}}
      </view>
    </view>
  </view>
  
  <!-- Education & Experience -->
  <view class="px-4 py-4 bg-white mt-2">
    <text class="font-bold mb-3 block">教育经历</text>
    <view class="space-y-2 mb-4">
      <view wx:for="{{expert.education}}" wx:key="*this" class="p-3 bg-blue-50 text-blue-700 rounded-md text-sm">
        {{item}}
      </view>
    </view>
    
    <text class="font-bold mb-3 block">工作经历</text>
    <view class="space-y-2">
      <view wx:for="{{expert.experience}}" wx:key="*this" class="p-3 bg-purple-50 text-purple-700 rounded-md text-sm">
        {{item}}
      </view>
    </view>
  </view>
  
  <!-- Consultation Options -->
  <view class="px-4 py-4 bg-white mt-2">
    <text class="font-bold mb-3 block">咨询方式</text>
    <view class="flex gap-2">
      <view 
        wx:for="{{consultTypes}}" 
        wx:key="id" 
        class="flex-1 py-2 rounded-lg text-center {{selectedConsultType === item.id ? 'bg-blue-100 text-blue-700 border-2 border-blue-300' : 'bg-gray-100 text-gray-700 border border-gray-200'}} text-sm font-medium"
        bindtap="selectConsultType"
        data-type="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>
  </view>
  
  <!-- Bottom Action Buttons -->
  <view class="fixed bottom-0 left-0 right-0 px-4 py-3 bg-white border-t border-gray-200">
    <view class="flex gap-3">
      <button class="flex-1 py-2 px-4 bg-green-50 text-green-600 border border-green-200 rounded-full" bindtap="handleBooking">预约问问</button>
      <button class="flex-1 py-2 px-4 bg-gradient-to-r from-blue-500 to-app-blue text-white rounded-full" bindtap="handleMessage">给TA留言</button>
    </view>
  </view>
  
  <!-- Message Dialog -->
  <view class="message-dialog {{showMessageDialog ? 'block' : 'hidden'}}">
    <view class="dialog-overlay" bindtap="closeMessageDialog"></view>
    <view class="dialog-content bg-white rounded-t-xl p-4 space-y-4">
      <view class="flex justify-between items-center">
        <text class="font-bold">给 {{expert.name}} 留言</text>
        <view bindtap="closeMessageDialog">
          <image src="/assets/icons/close.png" class="w-5 h-5" />
        </view>
      </view>
      
      <textarea placeholder="请输入留言内容..." class="w-full h-32 p-3 border border-gray-200 rounded-lg text-sm" bindinput="onMessageInput" value="{{messageText}}"></textarea>
      
      <view class="flex justify-between items-center">
        <view class="flex items-center">
          <image src="/assets/icons/sun.png" class="w-4 h-4 mr-1" />
          <text class="text-sm text-yellow-500">消耗 5 积分</text>
        </view>
        <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-app-blue text-white rounded-full text-sm" bindtap="sendMessage">发送留言</button>
      </view>
    </view>
  </view>
  
  <!-- Booking Dialog -->
  <view class="booking-dialog {{showBookingDialog ? 'block' : 'hidden'}}">
    <view class="dialog-overlay" bindtap="closeBookingDialog"></view>
    <view class="dialog-content bg-white rounded-t-xl p-4 space-y-4">
      <view class="flex justify-between items-center">
        <text class="font-bold">预约 {{expert.name}}</text>
        <view bindtap="closeBookingDialog">
          <image src="/assets/icons/close.png" class="w-5 h-5" />
        </view>
      </view>
      
      <view class="space-y-3">
        <view>
          <text class="font-medium block mb-2">选择擅长话题</text>
          <view class="flex flex-wrap gap-2">
            <view 
              wx:for="{{expert.tags}}" 
              wx:key="*this" 
              class="px-3 py-1.5 {{selectedTopics.includes(item) ? 'bg-blue-100 text-blue-700 border border-blue-300' : 'bg-gray-100 text-gray-700 border border-gray-200'}} rounded-full text-sm"
              bindtap="toggleTopic"
              data-topic="{{item}}"
            >
              {{item}}
            </view>
          </view>
        </view>
        
        <view>
          <text class="font-medium block mb-2">选择可预约时段</text>
          <view class="space-y-2">
            <view 
              wx:for="{{availableSlots}}" 
              wx:key="id" 
              class="flex justify-between items-center p-3 {{selectedSlot === item.id ? 'bg-blue-100 border border-blue-300' : 'bg-gray-50 border border-gray-200'}} rounded-lg"
              bindtap="selectTimeSlot"
              data-id="{{item.id}}"
            >
              <view>
                <text class="font-medium">{{item.date}}</text>
                <text class="text-sm text-gray-600 block">{{item.time}}</text>
              </view>
              <image src="{{selectedSlot === item.id ? '/assets/icons/check-circle.png' : '/assets/icons/circle.png'}}" class="w-5 h-5" />
            </view>
          </view>
        </view>
      </view>
      
      <view class="flex justify-between items-center">
        <view class="flex items-center">
          <image src="/assets/icons/sun.png" class="w-4 h-4 mr-1" />
          <text class="text-sm text-yellow-500">消耗 20 积分</text>
        </view>
        <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-app-blue text-white rounded-full text-sm" bindtap="confirmBooking">确认预约</button>
      </view>
    </view>
  </view>
</view>
