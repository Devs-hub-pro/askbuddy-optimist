
<view class="container">
  <!-- Top Navigation Bar -->
  <view class="header">
    <view class="nav-tabs">
      <view class="tab {{activeTab === 'chats' ? 'active' : ''}}" bindtap="switchTab" data-tab="chats">
        <text>ç§ä¿¡</text>
      </view>
      <view class="tab {{activeTab === 'notifications' ? 'active' : ''}}" bindtap="switchTab" data-tab="notifications">
        <text>é€šçŸ¥</text>
      </view>
    </view>
    
    <view class="header-actions">
      <view class="search-icon" bindtap="toggleSearch">
        <text class="icon">ğŸ”</text>
      </view>
      <view class="settings-icon" bindtap="openSettings">
        <text class="icon">âš™ï¸</text>
      </view>
    </view>
  </view>
  
  <!-- Search Bar (Hidden by default) -->
  <view class="search-container {{isSearchVisible ? 'visible' : 'hidden'}}">
    <input type="text" placeholder="æœç´¢è”ç³»äººæˆ–å…³é”®è¯" bindinput="onSearchInput" focus="{{isSearchVisible}}" />
    <text class="cancel-search" bindtap="toggleSearch">å–æ¶ˆ</text>
  </view>
  
  <!-- Content Area -->
  <view class="content-area">
    <!-- Chats Tab Content -->
    <view class="tab-content {{activeTab === 'chats' ? 'visible' : 'hidden'}}">
      <!-- Pinned Conversations -->
      <block wx:if="{{pinnedConversations.length > 0}}">
        <view class="section-title">ç½®é¡¶ä¼šè¯</view>
        <view class="conversations-list">
          <view wx:for="{{pinnedConversations}}" wx:key="id" class="conversation-item {{item.unread ? 'unread' : ''}}" 
                bindtap="openChat" data-id="{{item.id}}" 
                bindlongpress="showConversationActions" data-id="{{item.id}}">
            <view class="avatar">
              <image src="{{item.avatar}}" mode="aspectFill"></image>
              <view wx:if="{{item.online}}" class="online-indicator"></view>
            </view>
            <view class="conversation-content">
              <view class="conversation-header">
                <text class="name">{{item.name}}</text>
                <text class="time">{{item.lastMessageTime}}</text>
              </view>
              <view class="conversation-footer">
                <text class="preview">{{item.lastMessage}}</text>
                <view wx:if="{{item.unreadCount > 0}}" class="unread-badge">
                  {{item.unreadCount > 9 ? '9+' : item.unreadCount}}
                </view>
              </view>
            </view>
            <view class="pinned-indicator">ğŸ“Œ</view>
          </view>
        </view>
      </block>
      
      <!-- Regular Conversations -->
      <view class="section-title">æœ€è¿‘ä¼šè¯</view>
      <view class="conversations-list">
        <view wx:for="{{conversations}}" wx:key="id" class="conversation-item {{item.unread ? 'unread' : ''}}" 
              bindtap="openChat" data-id="{{item.id}}" 
              bindlongpress="showConversationActions" data-id="{{item.id}}">
          <view class="avatar">
            <image src="{{item.avatar}}" mode="aspectFill"></image>
            <view wx:if="{{item.online}}" class="online-indicator"></view>
          </view>
          <view class="conversation-content">
            <view class="conversation-header">
              <text class="name">{{item.name}}</text>
              <text class="time">{{item.lastMessageTime}}</text>
            </view>
            <view class="conversation-footer">
              <text class="preview">{{item.lastMessage}}</text>
              <view wx:if="{{item.unreadCount > 0}}" class="unread-badge">
                {{item.unreadCount > 9 ? '9+' : item.unreadCount}}
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- Empty State -->
      <view wx:if="{{conversations.length === 0 && pinnedConversations.length === 0}}" class="empty-state">
        <image src="/assets/images/empty-chat.png" mode="aspectFit"></image>
        <text>æš‚æ— ä¼šè¯ï¼Œå¼€å§‹æ–°å¯¹è¯å§</text>
      </view>
    </view>
    
    <!-- Notifications Tab Content -->
    <view class="tab-content {{activeTab === 'notifications' ? 'visible' : 'hidden'}}">
      <!-- Mark All as Read Button -->
      <view class="mark-all-read" bindtap="markAllNotificationsRead">
        <text>å…¨éƒ¨æ ‡ä¸ºå·²è¯»</text>
      </view>
      
      <!-- Notification Categories -->
      <view class="notification-categories">
        <view class="category-tab {{notificationCategory === 'all' ? 'active' : ''}}" bindtap="changeNotificationCategory" data-category="all">å…¨éƒ¨</view>
        <view class="category-tab {{notificationCategory === 'transaction' ? 'active' : ''}}" bindtap="changeNotificationCategory" data-category="transaction">äº¤æ˜“</view>
        <view class="category-tab {{notificationCategory === 'activity' ? 'active' : ''}}" bindtap="changeNotificationCategory" data-category="activity">æ´»åŠ¨</view>
        <view class="category-tab {{notificationCategory === 'interaction' ? 'active' : ''}}" bindtap="changeNotificationCategory" data-category="interaction">äº’åŠ¨</view>
        <view class="category-tab {{notificationCategory === 'system' ? 'active' : ''}}" bindtap="changeNotificationCategory" data-category="system">ç³»ç»Ÿ</view>
      </view>
      
      <!-- Notifications List -->
      <view class="notifications-list">
        <view wx:for="{{filteredNotifications}}" wx:key="id" class="notification-item {{item.read ? '' : 'unread'}}" 
              bindtap="openNotification" data-id="{{item.id}}" 
              bindlongpress="showNotificationActions" data-id="{{item.id}}">
          <view class="notification-icon {{item.type}}">
            <text wx:if="{{item.type === 'transaction'}}">ğŸ¯</text>
            <text wx:elif="{{item.type === 'activity'}}">ğŸ“¢</text>
            <text wx:elif="{{item.type === 'interaction'}}">ğŸ’Œ</text>
            <text wx:elif="{{item.type === 'system'}}">ğŸ””</text>
          </view>
          <view class="notification-content">
            <view class="notification-header">
              <text class="title">{{item.title}}</text>
              <text class="time">{{item.time}}</text>
            </view>
            <text class="message">{{item.message}}</text>
          </view>
          <view wx:if="{{!item.read}}" class="unread-indicator"></view>
        </view>
      </view>
      
      <!-- Empty State for Notifications -->
      <view wx:if="{{filteredNotifications.length === 0}}" class="empty-state">
        <image src="/assets/images/empty-notification.png" mode="aspectFit"></image>
        <text>æš‚æ— é€šçŸ¥</text>
      </view>
    </view>
  </view>
  
  <!-- Context Menus (Hidden by default) -->
  <view class="context-menu {{showConversationMenu ? 'visible' : 'hidden'}}" style="top: {{menuPosition.y}}px; left: {{menuPosition.x}}px;">
    <view class="menu-item" bindtap="togglePinConversation">
      <text>{{selectedConversation.pinned ? 'å–æ¶ˆç½®é¡¶' : 'ç½®é¡¶ä¼šè¯'}}</text>
    </view>
    <view class="menu-item" bindtap="markConversationRead">
      <text>{{selectedConversation.unread ? 'æ ‡è®°å·²è¯»' : 'æ ‡è®°æœªè¯»'}}</text>
    </view>
    <view class="menu-item" bindtap="archiveConversation">
      <text>å½’æ¡£ä¼šè¯</text>
    </view>
    <view class="menu-item delete" bindtap="confirmDeleteConversation">
      <text>åˆ é™¤ä¼šè¯</text>
    </view>
  </view>
  
  <view class="context-menu {{showNotificationMenu ? 'visible' : 'hidden'}}" style="top: {{menuPosition.y}}px; left: {{menuPosition.x}}px;">
    <view class="menu-item" bindtap="toggleNotificationRead">
      <text>{{selectedNotification.read ? 'æ ‡è®°æœªè¯»' : 'æ ‡è®°å·²è¯»'}}</text>
    </view>
    <view class="menu-item delete" bindtap="deleteNotification">
      <text>åˆ é™¤é€šçŸ¥</text>
    </view>
  </view>
  
  <!-- Confirmation Dialog -->
  <view class="dialog-overlay {{showDeleteDialog ? 'visible' : 'hidden'}}" bindtap="cancelDelete">
    <view class="dialog-container" catchtap="preventBubble">
      <view class="dialog-title">ç¡®è®¤åˆ é™¤</view>
      <view class="dialog-content">
        <text>åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œæ˜¯å¦ç¡®è®¤åˆ é™¤ï¼Ÿ</text>
      </view>
      <view class="dialog-buttons">
        <button class="cancel-button" bindtap="cancelDelete">å–æ¶ˆ</button>
        <button class="confirm-button" bindtap="confirmDelete">åˆ é™¤</button>
      </view>
    </view>
  </view>
</view>
