
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="status-bar"></view>
    <view class="nav-content">
      <view class="nav-left">
        <view class="back-button" bindtap="navigateBack">
          <text class="icon">â†</text>
        </view>
      </view>
      
      <view class="nav-center">
        <view class="tabs">
          <view class="tab {{activeTab === 'messages' ? 'active' : ''}}" bindtap="switchTab" data-tab="messages">
            ç§ä¿¡
          </view>
          <view class="tab {{activeTab === 'notifications' ? 'active' : ''}}" bindtap="switchTab" data-tab="notifications">
            é€šçŸ¥
          </view>
        </view>
      </view>
      
      <view class="nav-right">
        <view class="search-icon" bindtap="toggleSearch">
          <text class="icon">ğŸ”</text>
        </view>
        <view class="settings-icon" bindtap="navigateToSettings">
          <text class="icon">âš™ï¸</text>
        </view>
      </view>
    </view>
    
    <!-- æœç´¢æ¡† -->
    <view class="search-bar {{showSearch ? 'show' : 'hide'}}">
      <input 
        type="text" 
        placeholder="æœç´¢è”ç³»äººæˆ–å…³é”®è¯" 
        value="{{searchQuery}}" 
        bindinput="handleSearchInput"
        focus="{{showSearch}}"
      />
      <view class="cancel-search" bindtap="toggleSearch">å–æ¶ˆ</view>
    </view>
  </view>
  
  <!-- ä¸»å†…å®¹åŒº -->
  <view class="content">
    <!-- ç§ä¿¡ä¼šè¯åˆ—è¡¨ -->
    <view class="conversations-list" wx:if="{{activeTab === 'messages'}}">
      <view class="archived-link" bindtap="showArchivedConversations" wx:if="{{archivedConversations.length > 0}}">
        å·²å½’æ¡£ä¼šè¯ ({{archivedConversations.length}})
      </view>
      
      <view 
        class="conversation-item {{item.isPinned ? 'pinned' : ''}} {{!item.isRead ? 'unread' : ''}}" 
        wx:for="{{conversations}}" 
        wx:key="id"
        bindtap="navigateToChat"
        bindlongpress="handleLongPressConversation"
        data-id="{{item.id}}"
      >
        <view class="pin-indicator" wx:if="{{item.isPinned}}">
          <text class="pin-icon">ğŸ“Œ</text>
        </view>
        
        <view class="avatar">
          <image src="{{item.avatar}}" mode="aspectFill"></image>
        </view>
        
        <view class="conversation-details">
          <view class="conversation-header">
            <view class="name">{{item.name}}</view>
            <view class="time">{{item.time}}</view>
          </view>
          
          <view class="conversation-body">
            <view class="last-message">{{item.lastMessage}}</view>
            <view class="unread-badge" wx:if="{{item.unread > 0}}">
              {{item.unread > 9 ? '9+' : item.unread}}
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{conversations.length === 0}}">
        <image src="/assets/icons/empty-messages.png" mode="aspectFit"></image>
        <view class="empty-text">æš‚æ— ç§ä¿¡</view>
      </view>
    </view>
    
    <!-- é€šçŸ¥åˆ—è¡¨ -->
    <view class="notifications-list" wx:if="{{activeTab === 'notifications'}}">
      <view class="notifications-header">
        <view class="mark-all-read" bindtap="markAllNotificationsAsRead">
          å…¨éƒ¨å·²è¯»
        </view>
      </view>
      
      <view class="notifications-groups">
        <!-- äº¤æ˜“é€šçŸ¥ -->
        <view class="notification-group">
          <view class="group-title">äº¤æ˜“ç›¸å…³</view>
          
          <view 
            class="notification-item {{!item.isRead ? 'unread' : ''}}" 
            wx:for="{{notifications}}" 
            wx:key="id"
            wx:if="{{item.type === 'transaction'}}"
            bindtap="viewNotification"
            data-id="{{item.id}}"
            data-type="{{item.type}}"
          >
            <view class="notification-icon transaction">ğŸ›’</view>
            <view class="notification-content">
              <view class="notification-title">{{item.title}}</view>
              <view class="notification-text">{{item.content}}</view>
              <view class="notification-time">{{item.time}}</view>
            </view>
          </view>
        </view>
        
        <!-- æ´»åŠ¨é€šçŸ¥ -->
        <view class="notification-group">
          <view class="group-title">æ´»åŠ¨ä¿¡æ¯</view>
          
          <view 
            class="notification-item {{!item.isRead ? 'unread' : ''}}" 
            wx:for="{{notifications}}" 
            wx:key="id"
            wx:if="{{item.type === 'activity'}}"
            bindtap="viewNotification"
            data-id="{{item.id}}"
            data-type="{{item.type}}"
          >
            <view class="notification-icon activity">ğŸ‰</view>
            <view class="notification-content">
              <view class="notification-title">{{item.title}}</view>
              <view class="notification-text">{{item.content}}</view>
              <view class="notification-time">{{item.time}}</view>
            </view>
          </view>
        </view>
        
        <!-- äº’åŠ¨é€šçŸ¥ -->
        <view class="notification-group">
          <view class="group-title">äº’åŠ¨æé†’</view>
          
          <view 
            class="notification-item {{!item.isRead ? 'unread' : ''}}" 
            wx:for="{{notifications}}" 
            wx:key="id"
            wx:if="{{item.type === 'interaction'}}"
            bindtap="viewNotification"
            data-id="{{item.id}}"
            data-type="{{item.type}}"
          >
            <view class="notification-icon interaction">â¤ï¸</view>
            <view class="notification-content">
              <view class="notification-title">{{item.title}}</view>
              <view class="notification-text">{{item.content}}</view>
              <view class="notification-time">{{item.time}}</view>
            </view>
          </view>
        </view>
        
        <!-- ç³»ç»Ÿé€šçŸ¥ -->
        <view class="notification-group">
          <view class="group-title">ç³»ç»Ÿå…¬å‘Š</view>
          
          <view 
            class="notification-item {{!item.isRead ? 'unread' : ''}}" 
            wx:for="{{notifications}}" 
            wx:key="id"
            wx:if="{{item.type === 'system'}}"
            bindtap="viewNotification"
            data-id="{{item.id}}"
            data-type="{{item.type}}"
          >
            <view class="notification-icon system">ğŸ“¢</view>
            <view class="notification-content">
              <view class="notification-title">{{item.title}}</view>
              <view class="notification-text">{{item.content}}</view>
              <view class="notification-time">{{item.time}}</view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{notifications.length === 0}}">
        <image src="/assets/icons/empty-notifications.png" mode="aspectFit"></image>
        <view class="empty-text">æš‚æ— é€šçŸ¥</view>
      </view>
    </view>
  </view>
</view>
