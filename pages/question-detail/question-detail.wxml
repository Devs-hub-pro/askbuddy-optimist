
<view class="container">
  <!-- Navbar -->
  <view class="sticky top-0 z-50 bg-app-teal animate-fade-in">
    <view class="flex items-center h-12 px-4">
      <view bindtap="handleBack" class="flex items-center">
        <image src="/assets/icons/arrow-left.png" style="width: 24px; height: 24px;" />
      </view>
      <view class="text-white font-medium text-base ml-2">问题详情</view>
    </view>
  </view>
  
  <!-- Question Content -->
  <view class="px-4 py-4 bg-white">
    <!-- Question header -->
    <view class="flex items-center justify-between mb-4">
      <view class="flex items-center" bindtap="viewAskerProfile" data-id="{{question.asker.id}}">
        <image class="w-10 h-10 rounded-full" src="{{question.asker.avatar}}" />
        <view class="ml-3">
          <text class="font-medium">{{question.asker.name}}</text>
          <text class="text-xs text-gray-500 block">{{question.time}}</text>
        </view>
      </view>
      
      <view class="flex items-center bg-yellow-50 px-2 py-1 rounded-full">
        <image src="/assets/icons/sun.png" class="w-4 h-4 mr-1" />
        <text class="text-yellow-600 text-sm font-medium">{{question.points}} 积分</text>
      </view>
    </view>
    
    <!-- Question title and description -->
    <text class="font-bold text-lg block mb-3">{{question.title}}</text>
    <view class="bg-gray-50 p-4 rounded-lg mb-4">
      <text class="text-gray-700 text-sm">{{question.description}}</text>
    </view>
    
    <!-- Tags -->
    <view class="flex flex-wrap gap-2 mb-4">
      <view wx:for="{{question.tags}}" wx:key="*this" class="px-2.5 py-1 bg-blue-50 text-blue-600 rounded-full text-xs">
        #{{item}}
      </view>
    </view>
    
    <!-- Action Buttons -->
    <view class="flex justify-between">
      <button class="flex-1 py-2 mr-2 bg-white border border-gray-200 text-gray-700 rounded-full flex items-center justify-center" bindtap="handleInvite">
        <image src="/assets/icons/share.png" class="w-4 h-4 mr-1" />
        <text class="text-sm">邀请回答</text>
      </button>
      <button class="flex-1 py-2 ml-2 bg-gradient-to-r from-blue-500 to-app-blue text-white rounded-full flex items-center justify-center" bindtap="handleAnswer">
        <image src="/assets/icons/message.png" class="w-4 h-4 mr-1" />
        <text class="text-sm">我来回答</text>
      </button>
    </view>
  </view>
  
  <!-- Answers Section -->
  <view class="px-4 py-4 bg-white mt-2">
    <view class="flex items-center justify-between mb-4">
      <text class="font-bold">回答 ({{answers.length}})</text>
      <view class="flex items-center text-gray-500 text-sm">
        <text class="{{sortBy === 'newest' ? 'text-blue-600 font-medium' : ''}}" bindtap="setSortBy" data-sort="newest">最新</text>
        <text class="mx-2">|</text>
        <text class="{{sortBy === 'helpful' ? 'text-blue-600 font-medium' : ''}}" bindtap="setSortBy" data-sort="helpful">最有帮助</text>
      </view>
    </view>
    
    <block wx:if="{{!answers.length}}">
      <view class="text-center py-10">
        <image src="/assets/icons/no-data.png" class="w-16 h-16 mx-auto mb-4" />
        <text class="text-gray-500">暂无回答，快来成为第一个回答者吧！</text>
      </view>
    </block>
    
    <block wx:else>
      <view class="space-y-6">
        <view wx:for="{{answers}}" wx:key="id" class="border-b border-gray-100 pb-4 last:border-b-0">
          <view class="flex items-center justify-between mb-3">
            <view class="flex items-center" bindtap="viewAnswererProfile" data-id="{{item.answerer.id}}">
              <image class="w-8 h-8 rounded-full" src="{{item.answerer.avatar}}" />
              <view class="ml-2">
                <text class="font-medium text-sm">{{item.answerer.name}}</text>
                <text class="text-xs text-gray-500 block">{{item.answerer.title}}</text>
              </view>
            </view>
            
            <text class="text-xs text-gray-500">{{item.time}}</text>
          </view>
          
          <view class="text-sm text-gray-700 mb-3">
            <text>{{item.content}}</text>
          </view>
          
          <view class="flex items-center justify-between">
            <view class="flex items-center">
              <view bindtap="toggleLike" data-id="{{item.id}}" class="flex items-center mr-4 {{item.isLiked ? 'text-blue-600' : 'text-gray-500'}}">
                <image src="{{item.isLiked ? '/assets/icons/thumb-up-filled.png' : '/assets/icons/thumb-up.png'}}" class="w-4 h-4 mr-1" />
                <text class="text-xs">{{item.likes}}</text>
              </view>
              <view bindtap="toggleDislike" data-id="{{item.id}}" class="flex items-center {{item.isDisliked ? 'text-red-600' : 'text-gray-500'}}">
                <image src="{{item.isDisliked ? '/assets/icons/thumb-down-filled.png' : '/assets/icons/thumb-down.png'}}" class="w-4 h-4 mr-1" />
                <text class="text-xs">{{item.dislikes}}</text>
              </view>
            </view>
            
            <view bindtap="handleComment" data-id="{{item.id}}" class="flex items-center text-gray-500">
              <image src="/assets/icons/comment.png" class="w-4 h-4 mr-1" />
              <text class="text-xs">评论 ({{item.comments}})</text>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>
  
  <!-- Answer Dialog -->
  <view class="answer-dialog {{showAnswerDialog ? 'block' : 'hidden'}}">
    <view class="dialog-overlay" bindtap="closeAnswerDialog"></view>
    <view class="dialog-content bg-white rounded-t-xl p-4 space-y-4">
      <view class="flex justify-between items-center">
        <text class="font-bold">回答问题</text>
        <view bindtap="closeAnswerDialog">
          <image src="/assets/icons/close.png" class="w-5 h-5" />
        </view>
      </view>
      
      <view class="space-y-4">
        <view>
          <text class="font-medium block mb-2">选择咨询方式</text>
          <view class="flex gap-2">
            <view 
              wx:for="{{consultTypes}}" 
              wx:key="id" 
              class="flex-1 py-2 rounded-lg text-center {{selectedConsultType === item.id ? 'bg-blue-100 text-blue-700 border-2 border-blue-300' : 'bg-gray-100 text-gray-700 border border-gray-200'}} text-sm font-medium"
              bindtap="selectConsultType"
              data-type="{{item.id}}"
            >
              {{item.name}}
            </view>
          </view>
        </view>
        
        <view>
          <text class="font-medium block mb-2">选择可回答时段</text>
          <view class="space-y-2">
            <view 
              wx:for="{{availableSlots}}" 
              wx:key="id" 
              class="flex justify-between items-center p-3 {{selectedSlot === item.id ? 'bg-blue-100 border border-blue-300' : 'bg-gray-50 border border-gray-200'}} rounded-lg"
              bindtap="selectTimeSlot"
              data-id="{{item.id}}"
            >
              <view>
                <text class="font-medium">{{item.date}}</text>
                <text class="text-sm text-gray-600 block">{{item.time}}</text>
              </view>
              <image src="{{selectedSlot === item.id ? '/assets/icons/check-circle.png' : '/assets/icons/circle.png'}}" class="w-5 h-5" />
            </view>
          </view>
        </view>
        
        <textarea placeholder="补充说明（选填）..." class="w-full h-24 p-3 border border-gray-200 rounded-lg text-sm" bindinput="onAnswerInput" value="{{answerText}}"></textarea>
      </view>
      
      <view class="flex justify-between items-center">
        <view class="flex items-center">
          <image src="/assets/icons/sun.png" class="w-4 h-4 mr-1" />
          <text class="text-sm text-yellow-500">获得 {{question.points}} 积分</text>
        </view>
        <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-app-blue text-white rounded-full text-sm" bindtap="submitAnswer">提交回答</button>
      </view>
    </view>
  </view>
  
  <!-- Invite Dialog -->
  <view class="invite-dialog {{showInviteDialog ? 'block' : 'hidden'}}">
    <view class="dialog-overlay" bindtap="closeInviteDialog"></view>
    <view class="dialog-content bg-white rounded-t-xl p-4 space-y-4">
      <view class="flex justify-between items-center">
        <text class="font-bold">邀请回答</text>
        <view bindtap="closeInviteDialog">
          <image src="/assets/icons/close.png" class="w-5 h-5" />
        </view>
      </view>
      
      <view class="space-y-4">
        <view class="p-4 bg-yellow-50 rounded-lg">
          <view class="flex items-center mb-2">
            <image src="/assets/icons/sun.png" class="w-5 h-5 mr-2" />
            <text class="font-medium">积分奖励</text>
          </view>
          <text class="text-sm text-gray-700">邀请好友回答成功后，您将获得 5 积分奖励！</text>
        </view>
        
        <view>
          <text class="font-medium block mb-2">分享方式</text>
          <view class="grid grid-cols-4 gap-4">
            <view wx:for="{{shareOptions}}" wx:key="id" class="flex flex-col items-center" bindtap="shareQuestion" data-type="{{item.id}}">
              <view class="w-12 h-12 rounded-full {{item.bgColor}} flex items-center justify-center mb-1">
                <image src="{{item.icon}}" class="w-6 h-6" />
              </view>
              <text class="text-xs text-center">{{item.name}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
