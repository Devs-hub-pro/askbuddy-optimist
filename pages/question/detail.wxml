
<!-- Question Detail Page -->
<view class="container pb-20">
  <!-- Header with Navigation -->
  <view class="sticky top-0 z-50 bg-app-teal shadow-sm animate-fade-in">
    <view class="flex items-center h-12 px-4">
      <view bindtap="navigateBack" class="text-white">
        <image src="/assets/icons/arrow-left.png" style="width: 24px; height: 24px;" />
      </view>
      <view class="text-white font-medium text-base ml-2">问题详情</view>
      <view class="flex-1"></view>
      <button open-type="share" class="text-white bg-transparent border-0 p-0 m-0 leading-none">
        <image src="/assets/icons/share.png" style="width: 20px; height: 20px;" />
      </button>
    </view>
  </view>

  <block wx:if="{{isLoading}}">
    <!-- Loading Skeleton -->
    <view class="p-4 animate-pulse-soft">
      <view class="h-6 bg-gray-200 rounded w-3/4 mb-4"></view>
      <view class="flex items-center mb-4">
        <view class="w-8 h-8 bg-gray-200 rounded-full mr-2"></view>
        <view>
          <view class="h-4 bg-gray-200 rounded w-24 mb-1"></view>
          <view class="h-3 bg-gray-200 rounded w-16"></view>
        </view>
      </view>
      <view class="h-24 bg-gray-200 rounded mb-4"></view>
      <view class="flex flex-wrap gap-2 mb-4">
        <view class="h-6 bg-gray-200 rounded-full w-16"></view>
        <view class="h-6 bg-gray-200 rounded-full w-16"></view>
      </view>
      <view class="flex justify-between">
        <view class="h-8 bg-gray-200 rounded-full w-24"></view>
        <view class="h-8 bg-gray-200 rounded-full w-24"></view>
      </view>
    </view>
  </block>

  <block wx:else>
    <!-- Question Card -->
    <view class="p-4 bg-white shadow-sm mb-3">
      <view class="text-left">
        <text class="text-xl font-bold text-gray-800 mb-3 block">{{question.title}}</text>
      </view>
      
      <view class="flex items-center mb-4">
        <view 
          bindtap="viewExpertProfile"
          data-expert-id="{{question.asker.id}}"
          data-expert-name="{{question.asker.name}}"
          data-expert-avatar="{{question.asker.avatar}}"
          class="flex items-center cursor-pointer"
        >
          <image src="{{question.asker.avatar}}" class="w-8 h-8 rounded-full mr-2" mode="aspectFill"/>
          <view>
            <text class="text-sm font-medium block">{{question.asker.name}}</text>
            <text class="text-xs text-gray-500 block">{{question.time}}</text>
          </view>
        </view>
        <view class="ml-auto flex items-center space-x-2">
          <view class="flex items-center text-gray-500">
            <image src="/assets/icons/eye.png" style="width: 14px; height: 14px; margin-right: 4px;" />
            <text class="text-xs">{{question.viewCount}}</text>
          </view>
          <view class="bg-yellow-50 text-yellow-600 rounded-full px-2 py-1 text-xs flex items-center">
            <image src="/assets/icons/award.png" style="width: 12px; height: 12px; margin-right: 4px;" />
            {{question.points}} 积分
          </view>
        </view>
      </view>
      
      <view class="text-left mb-4">
        <view wx:if="{{!isDescriptionExpanded && question.description.length > 100}}">
          <text class="text-sm text-gray-700 leading-relaxed">{{question.description.substring(0, 100)}}...</text>
          <view bindtap="toggleDescription" class="text-blue-500 text-xs mt-2 hover-underline flex items-center">
            <text>展开全部</text>
            <image src="/assets/icons/chevron-down.png" style="width: 12px; height: 12px; margin-left: 2px;" />
          </view>
        </view>
        <view wx:else>
          <text class="text-sm text-gray-700 leading-relaxed">{{question.description}}</text>
          <block wx:if="{{isDescriptionExpanded && question.description.length > 100}}">
            <view bindtap="toggleDescription" class="text-blue-500 text-xs mt-2 hover-underline flex items-center">
              <text>收起</text>
              <image src="/assets/icons/chevron-up.png" style="width: 12px; height: 12px; margin-left: 2px;" />
            </view>
          </block>
        </view>
      </view>
      
      <view class="flex flex-wrap gap-2 mb-4">
        <block wx:for="{{question.tags}}" wx:key="*this">
          <text class="bg-green-50 text-green-600 text-xs px-2.5 py-1 rounded-full border border-green-100">
            #{{item}}
          </text>
        </block>
      </view>
      
      <view class="flex justify-between">
        <view bindtap="saveBookmark" class="flex items-center border border-gray-200 rounded-md px-3 py-1.5 text-xs text-gray-600">
          <image src="/assets/icons/bookmark.png" style="width: 14px; height: 14px; margin-right: 4px;" />
          收藏
        </view>
        <view bindtap="shareToFriend" class="flex items-center border border-gray-200 rounded-md px-3 py-1.5 text-xs text-gray-600">
          <image src="/assets/icons/share.png" style="width: 14px; height: 14px; margin-right: 4px;" />
          分享
        </view>
      </view>
    </view>
    
    <!-- Answers Section -->
    <view class="px-4 mb-4">
      <view class="flex justify-between items-center mb-3">
        <text class="font-bold text-lg text-left">回答 ({{answers.length}})</text>
        <view class="flex items-center text-blue-500 text-xs">
          <text>按热度排序</text>
          <image src="/assets/icons/chevron-down.png" style="width: 14px; height: 14px; margin-left: 2px;" />
        </view>
      </view>
      
      <view class="space-y-4">
        <block wx:for="{{answers}}" wx:key="id">
          <view class="bg-white p-4 rounded-lg shadow-sm">
            <view class="flex justify-between mb-3">
              <view 
                bindtap="viewExpertProfile"
                data-expert-id="{{item.author.id}}"
                data-expert-name="{{item.author.name}}"
                data-expert-avatar="{{item.author.avatar}}"
                class="flex items-center cursor-pointer"
              >
                <image src="{{item.author.avatar}}" class="w-8 h-8 rounded-full mr-2" mode="aspectFill"/>
                <view>
                  <text class="text-sm font-medium block">{{item.author.name}}</text>
                  <text class="text-xs text-gray-500 block">{{item.author.title}}</text>
                </view>
              </view>
              <view wx:if="{{item.isBest}}" class="bg-yellow-50 text-yellow-600 rounded-full px-2 py-1 text-xs flex items-center">
                最佳回答
              </view>
            </view>
            <view class="text-left mb-3">
              <text class="text-sm text-gray-700 whitespace-pre-line">{{item.content}}</text>
            </view>
            <view class="flex justify-between text-xs text-gray-500">
              <text>{{item.time}}</text>
              <view class="flex items-center space-x-4">
                <view class="flex items-center">
                  <image src="/assets/icons/eye.png" style="width: 12px; height: 12px; margin-right: 4px;" />
                  <text>{{item.viewCount}}</text>
                </view>
                <view class="text-blue-500">
                  回复
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </block>

  <!-- Fixed Bottom Actions -->
  <view class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-3 flex gap-3">
    <button bindtap="handleShareDialog" class="flex-1 py-2 bg-white border border-app-teal text-app-teal rounded-full text-sm font-medium flex items-center justify-center">
      <image src="/assets/icons/mail.png" style="width: 16px; height: 16px; margin-right: 4px;" />
      邀请回答
    </button>
    <button bindtap="handleAnswerDialog" class="flex-1 py-2 bg-gradient-to-r from-app-teal to-app-blue text-white rounded-full text-sm font-medium flex items-center justify-center">
      <image src="/assets/icons/message-square.png" style="width: 16px; height: 16px; margin-right: 4px;" class="invert" />
      我来回答
    </button>
  </view>

  <!-- Answer Dialog -->
  <view class="dialog-mask {{showAnswerDialog ? 'show' : ''}}" catchtap="hideAnswerDialog">
    <view class="dialog-container" catchtap="preventBubble">
      <view class="dialog-header">
        <text class="dialog-title">回答问题</text>
        <view class="dialog-close" catchtap="hideAnswerDialog">
          <image src="/assets/icons/x.png" style="width: 20px; height: 20px;" />
        </view>
      </view>
      <view class="dialog-content">
        <view class="mb-4">
          <text class="text-sm font-medium mb-2 block">可选时间段</text>
          <view class="grid grid-cols-3 gap-2">
            <block wx:for="{{availableTimes}}" wx:key="id">
              <view 
                bindtap="selectTime" 
                data-id="{{item.id}}"
                class="border {{selectedTime === item.id ? 'border-app-teal bg-app-teal/10 text-app-teal' : 'border-gray-200 text-gray-700'}} rounded-md py-2 text-center text-sm"
              >
                {{item.label}}
              </view>
            </block>
          </view>
        </view>
        
        <view class="mb-4">
          <text class="text-sm font-medium mb-2 block">咨询方式</text>
          <view class="flex gap-2">
            <view 
              bindtap="selectConsultType" 
              data-type="text"
              class="flex-1 border {{selectedConsultType === 'text' ? 'border-app-teal bg-app-teal/10 text-app-teal' :    'border-gray-200 text-gray-700'}} rounded-md py-2 text-center text-sm flex items-center justify-center"
            >
              <image src="{{selectedConsultType === 'text' ? '/assets/icons/message-square-active.png' : '/assets/icons/message-square.png'}}" style="width: 16px; height: 16px; margin-right: 4px;" />
              文字
            </view>
            <view 
              bindtap="selectConsultType" 
              data-type="voice"
              class="flex-1 border {{selectedConsultType === 'voice' ? 'border-app-teal bg-app-teal/10 text-app-teal' : 'border-gray-200 text-gray-700'}} rounded-md py-2 text-center text-sm flex items-center justify-center"
            >
              <image src="{{selectedConsultType === 'voice' ? '/assets/icons/mic-active.png' : '/assets/icons/mic.png'}}" style="width: 16px; height: 16px; margin-right: 4px;" />
              语音
            </view>
            <view 
              bindtap="selectConsultType" 
              data-type="video"
              class="flex-1 border {{selectedConsultType === 'video' ? 'border-app-teal bg-app-teal/10 text-app-teal' : 'border-gray-200 text-gray-700'}} rounded-md py-2 text-center text-sm flex items-center justify-center"
            >
              <image src="{{selectedConsultType === 'video' ? '/assets/icons/video-active.png' : '/assets/icons/video.png'}}" style="width: 16px; height: 16px; margin-right: 4px;" />
              视频
            </view>
          </view>
        </view>
        
        <view class="mb-4">
          <text class="text-sm font-medium mb-2 block">回答内容</text>
          <textarea 
            placeholder="请输入您的回答..." 
            class="dialog-textarea" 
            bindinput="handleAnswerInput"
            value="{{answerText}}"
          ></textarea>
        </view>
        
        <button bindtap="submitAnswer" class="dialog-button">提交回答</button>
      </view>
    </view>
  </view>

  <!-- Share Dialog -->
  <view class="dialog-mask {{showShareDialog ? 'show' : ''}}" catchtap="hideShareDialog">
    <view class="dialog-container" catchtap="preventBubble">
      <view class="dialog-header">
        <text class="dialog-title">邀请回答</text>
        <view class="dialog-close" catchtap="hideShareDialog">
          <image src="/assets/icons/x.png" style="width: 20px; height: 20px;" />
        </view>
      </view>
      <view class="dialog-content">
        <view class="flex justify-center gap-4 mb-4">
          <view class="flex flex-col items-center">
            <view bindtap="shareToFriend" class="bg-blue-50 rounded-full p-3 text-blue-500">
              <image src="/assets/icons/message-square.png" style="width: 24px; height: 24px;" />
            </view>
            <text class="text-xs mt-1">站内好友</text>
          </view>
          <view class="flex flex-col items-center">
            <view bindtap="shareToWechat" class="bg-green-50 rounded-full p-3 text-green-500">
              <image src="/assets/icons/external-link.png" style="width: 24px; height: 24px;" />
            </view>
            <text class="text-xs mt-1">微信</text>
          </view>
          <view class="flex flex-col items-center">
            <view bindtap="shareToQQ" class="bg-blue-50 rounded-full p-3 text-blue-500">
              <image src="/assets/icons/mail.png" style="width: 24px; height: 24px;" />
            </view>
            <text class="text-xs mt-1">QQ</text>
          </view>
          <view class="flex flex-col items-center">
            <view bindtap="shareToTiktok" class="bg-red-50 rounded-full p-3 text-red-500">
              <image src="/assets/icons/user.png" style="width: 24px; height: 24px;" />
            </view>
            <text class="text-xs mt-1">抖音</text>
          </view>
        </view>
        <view class="bg-yellow-50 p-3 rounded-lg text-center text-sm">
          <text class="text-yellow-700 block">邀请好友回答，可获得<text class="font-bold">10积分</text>奖励</text>
          <text class="text-yellow-600 text-xs mt-1 block">好友回答被采纳，额外获得<text class="font-bold">20积分</text></text>
        </view>
      </view>
    </view>
  </view>
</view>
